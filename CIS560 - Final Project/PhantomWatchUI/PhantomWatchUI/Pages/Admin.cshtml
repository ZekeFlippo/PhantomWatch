@page
@model PhantomWatchUI.Pages.AdminModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<h2 class="pw-title">Admin Dashboard</h2>

<div class="pw-admin-grid">


    <div class="pw-card">
        <h3>Quick Stats</h3>
        <p><strong>Total Users:</strong> @Model.TotalUsers</p>
        <p><strong>Repeat Reporters:</strong> @Model.RepeatReporters.Count()</p>
        <p><strong>One-Time Reporters:</strong> @Model.OneTimeReporters.Count()</p>
    </div>

    <div class="pw-card collapsible">

        <div class="collapse-header" onclick="toggleSection('reporters')">
            <h3>Reporter Activity</h3>
            <span id="reporters-icon" class="collapse-icon">▼</span>
        </div>

        <div id="reporters" class="collapse-content">
            <table class="pw-table">
                <thead>
                    <tr>
                        <th>Full Name</th>
                        <th>Reports</th>
                        <th>Avg Credibility</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Model.ReporterStats)
                    {
                        <tr>
                            <td>@r.FullName</td>
                            <td>@r.ReportCount</td>
                            <td>@r.AvgCredibility.ToString("F2")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>

    <div class="pw-card collapsible">

        <div class="collapse-header" onclick="toggleSection('sorted')">
            <h3>Sorted Sightings</h3>
            <span id="sorted-icon" class="collapse-icon">▼</span>
        </div>

        <div id="sorted" class="collapse-content">
            <ul>
                @foreach (var s in Model.SortedSightings)
                {
                    <li>
                        <strong>@s.FullName</strong> – @s.EntityName –
                        @s.City, @s.State – Score @s.Credibility
                    </li>
                }
            </ul>
        </div>

    </div>


</div>

<hr />


<div class="pw-card">
    <h3>Top 10 Locations by Weighted Credibility</h3>
    <ul>
        @foreach (var loc in Model.TopLocations)
        {
            <li>@loc.Location – @loc.Score</li>
        }
    </ul>
</div>

<hr />


<div class="pw-card">
    <h3>Sightings Above Scary Level</h3>

    <form method="get">
        <input type="number" asp-for="MinScaryLevel" min="1" max="10" />
        <button class="pw-button" type="submit">Filter</button>
    </form>

    @foreach (var s in Model.FilteredByScary)
    {
        <p>@s.EntityName – Scary @s.ScaryLevel – @s.City, @s.State</p>
    }
</div>


<script>
    function toggleSection(id) {
        const content = document.getElementById(id);
        const icon = document.getElementById(id + "-icon");

        if (content.style.display === "none") {
            content.style.display = "block";
            icon.textContent = "▼";
        } else {
            content.style.display = "none";
            icon.textContent = "▲";
        }
    }
</script>
